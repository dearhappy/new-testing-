<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGB Brandsafway - Professional Onboarding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        .step { display: none; }
        .step.active { display: block; animation: fadeInRight 0.5s ease-out; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .input-focus:focus {
            ring: 2px;
            ring-color: #3b82f6;
            border-color: #3b82f6;
            outline: none;
            transition: all 0.3s ease;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .step-circle.active {
            background-color: #2563eb;
            color: white;
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.4);
            transform: scale(1.1);
        }

        .child-box {
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
        }
        
        .child-box:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }

        @keyframes fadeInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">

    <!-- Decorative background elements -->
    <div class="fixed top-0 left-0 w-full h-full -z-10 overflow-hidden">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-100 rounded-full blur-[100px] opacity-50"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-indigo-100 rounded-full blur-[100px] opacity-50"></div>
    </div>

    <div class="glass-card w-full max-w-3xl rounded-2xl shadow-2xl p-6 md:p-10 animate__animated animate__fadeIn">
        
        <!-- Header & Stepper -->
        <div class="mb-10">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">Joining Form</h1>
                    <p class="text-slate-500 text-sm mt-1">SGB Brandsafway Pvt Ltd - Employee Enrollment</p>
                </div>
                <div class="hidden sm:flex space-x-4">
                    <div id="circle1" class="step-circle active font-bold">1</div>
                    <div class="h-0.5 w-8 bg-slate-200 mt-5"></div>
                    <div id="circle2" class="step-circle bg-slate-100 text-slate-400 font-bold">2</div>
                </div>
            </div>
            
            <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-blue-600 w-1/2 transition-all duration-500 ease-out"></div>
            </div>
        </div>

        <form id="onboardingForm" class="space-y-6">
            <!-- Hidden Fields (Required for Google Sheets) -->
            <input type="hidden" name="Date of Joining" value="">
            <input type="hidden" name="Designation" value="">
            <input type="hidden" name="Grade" value="">
            <input type="hidden" name="Project Code" value="">
            <input type="hidden" name="Gross Salary" value="">
            <input type="hidden" name="Current Address" value="">
            <input type="hidden" name="Work Location" value="">
            <input type="hidden" name="Client Name" value="">
            <input type="hidden" name="PF Location" value="">
            <input type="hidden" name="UAN remarks" value="">
            <input type="hidden" name="ESI Remark" value="">

            <!-- STEP 1: Personal Information -->
            <div id="step1" class="step active">
                <h3 class="text-xl font-bold mb-6 text-slate-700 flex items-center">
                    <span class="w-8 h-8 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center mr-3 text-sm">01</span>
                    Personal & Banking Details
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                    <div class="group">
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Employee Name (Aadhar)</label>
                        <input type="text" name="Employee Name(AsperAadhar)" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Date of Birth</label>
                        <input type="date" name="Date of Birth" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Gender</label>
                        <select name="Gender" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Blood Group</label>
                        <input type="text" name="Blood Group" placeholder="e.g. O+" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Marital Status</label>
                        <select name="Marital Status" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                            <option value="">Select Status</option>
                            <option value="Single">Single</option>
                            <option value="Married">Married</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Permanent Address</label>
                        <input type="text" name="Permanent Address" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Contact No</label>
                        <input type="tel" name="Contact No" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Aadhar No</label>
                        <input type="text" name="AdharNo" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-blue-50/50 rounded-2xl mt-2">
                        <div>
                            <label class="text-xs font-semibold text-blue-600 uppercase mb-1 ml-1">Bank Name</label>
                            <input type="text" name="Bank Name" class="input-focus w-full px-4 py-2 bg-white border border-blue-100 rounded-lg">
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-blue-600 uppercase mb-1 ml-1">Account Number</label>
                            <input type="text" name="Account No" class="input-focus w-full px-4 py-2 bg-white border border-blue-100 rounded-lg">
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-blue-600 uppercase mb-1 ml-1">IFSC Code</label>
                            <input type="text" name="IFSC Code" class="input-focus w-full px-4 py-2 bg-white border border-blue-100 rounded-lg">
                        </div>
                    </div>
                </div>
                <div class="mt-10 flex justify-end">
                    <button type="button" onclick="nextStep(2)" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 hover:-translate-y-1 transition-all">
                        Continue to Next Part
                    </button>
                </div>
            </div>

            <!-- STEP 2: Family & Professional -->
            <div id="step2" class="step">
                <h3 class="text-xl font-bold mb-6 text-slate-700 flex items-center">
                    <span class="w-8 h-8 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center mr-3 text-sm">02</span>
                    Family & Experience Details
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Father's Name</label>
                        <input type="text" name="Father name" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Mother's Name</label>
                        <input type="text" name="Mother Name" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Wife's Name</label>
                        <input type="text" name="Wife Name" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">No. of Children</label>
                        <input type="number" name="No.Childrens" id="numChildren" min="0" max="3" oninput="updateChildrenFields()" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    
                    <!-- Dynamic Children -->
                    <div id="childrenContainer" class="col-span-full space-y-4"></div>

                    <div class="md:col-span-2 h-px bg-slate-100 my-2"></div>

                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Education</label>
                        <input type="text" name="Education" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Work Experience (Years)</label>
                        <input type="number" name="Scaffolding Work Experience" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Emergency Contact No</label>
                        <input type="tel" name="Emergency Contact No" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 ml-1">Emergency Relation</label>
                        <input type="text" name="Employee Relationwith EmergencyContactNo" placeholder="e.g. Brother" class="input-focus w-full px-4 py-2.5 bg-white border border-slate-200 rounded-xl">
                    </div>
                </div>
                <div class="mt-10 flex justify-between items-center">
                    <button type="button" onclick="nextStep(1)" class="text-slate-500 font-semibold hover:text-slate-800 transition-colors">
                        ← Go Back
                    </button>
                    <button type="submit" id="submitBtn" class="bg-emerald-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-emerald-100 hover:bg-emerald-700 hover:-translate-y-1 transition-all flex items-center">
                        <span id="btnText">Submit & Download Form</span>
                        <div id="loader" class="hidden ml-3 w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwn1oDVHfFgKqMJfkguVyGxuY7WO5z9yupblXVc4J2zfiMZF6AJITZOWAZDJ3To-j0gBQ/exec'; 
        const form = document.getElementById('onboardingForm');

        function nextStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
            
            // UI Updates for engagement
            const bar = document.getElementById('progressBar');
            const c1 = document.getElementById('circle1');
            const c2 = document.getElementById('circle2');
            
            if (step === 2) {
                bar.style.width = '100%';
                c2.classList.add('active');
            } else {
                bar.style.width = '50%';
                c2.classList.remove('active');
            }
        }

        function updateChildrenFields() {
            const container = document.getElementById('childrenContainer');
            const count = parseInt(document.getElementById('numChildren').value) || 0;
            const maxChildren = 3; 
            
            container.innerHTML = '';
            
            for (let i = 1; i <= Math.min(count, maxChildren); i++) {
                const childDiv = document.createElement('div');
                childDiv.className = 'child-box grid grid-cols-1 md:grid-cols-3 gap-3 p-4 bg-slate-50 rounded-xl animate__animated animate__fadeInUp';
                childDiv.innerHTML = `
                    <div class="col-span-full flex items-center mb-1">
                         <div class="w-1.5 h-4 bg-blue-500 rounded-full mr-2"></div>
                         <span class="text-xs font-bold text-slate-600 uppercase">Child ${i} Details</span>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Full Name</label>
                        <input type="text" name="Child ${i} Name" class="input-focus px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Son/Daughter</label>
                        <select name="Son/Daughter" class="input-focus px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-sm">
                            <option value="">Select</option>
                            <option value="Son">Son</option>
                            <option value="Daughter">Daughter</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Date of Birth</label>
                        <input type="date" name="Child ${i} DOB" class="input-focus px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-sm">
                    </div>
                `;
                container.appendChild(childDiv);
            }
        }

        form.addEventListener('submit', e => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const loader = document.getElementById('loader');
            
            submitBtn.disabled = true;
            btnText.innerText = "Processing Data...";
            loader.classList.remove('hidden');

            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                .then(response => response.json())
                .then(data => {
                    if(data.result === 'success') {
                        generatePDF();
                        // Custom Alert for engagement
                        const successMsg = document.createElement('div');
                        successMsg.className = 'fixed top-10 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-8 py-4 rounded-2xl shadow-2xl animate__animated animate__bounceInDown flex items-center z-50';
                        successMsg.innerHTML = '<span class="mr-3 text-2xl">✔</span> <div><p class="font-bold">Success!</p><p class="text-xs opacity-80">Form submitted & PDF Generated.</p></div>';
                        document.body.appendChild(successMsg);
                        
                        setTimeout(() => {
                            successMsg.classList.replace('animate__bounceInDown', 'animate__bounceOutUp');
                            setTimeout(() => successMsg.remove(), 1000);
                        }, 3000);

                        form.reset();
                        document.getElementById('childrenContainer').innerHTML = '';
                        nextStep(1);
                    } else {
                        throw new Error('Server error');
                    }
                })
                .catch(error => {
                    alert('Error submitting form. Please check your Script URL or Internet connection.');
                    console.error('Error!', error.message);
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    btnText.innerText = "Submit & Download Form";
                    loader.classList.add('hidden');
                });
        });

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const data = new FormData(form);
            const get = (key) => data.get(key) || "________________";

            // Colors
            const primaryColor = [37, 99, 235];
            const secondaryColor = [71, 85, 105];

            // Header Section
            doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
            doc.rect(0, 0, 210, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(24);
            doc.text("SGB BRANDSAFWAY PVT LTD", 105, 22, { align: "center" });
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text("PROFESSIONAL EMPLOYEE ONBOARDING FORM", 105, 30, { align: "center" });

            // Body
            doc.setTextColor(0, 0, 0);
            let y = 55;

            const sectionHeader = (title) => {
                doc.setFont("helvetica", "bold");
                doc.setFontSize(14);
                doc.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.text(title, 20, y);
                y += 2;
                doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.setLineWidth(0.5);
                doc.line(20, y, 190, y);
                y += 10;
            };

            const drawRow = (label1, val1, label2, val2) => {
                doc.setFontSize(9);
                doc.setFont("helvetica", "bold");
                doc.setTextColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                doc.text(label1 + ":", 20, y);
                
                doc.setFont("helvetica", "normal");
                doc.setTextColor(0, 0, 0);
                doc.text(String(val1), 60, y);
                
                if (label2) {
                    doc.setFont("helvetica", "bold");
                    doc.setTextColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                    doc.text(label2 + ":", 110, y);
                    doc.setFont("helvetica", "normal");
                    doc.setTextColor(0, 0, 0);
                    doc.text(String(val2), 150, y);
                }
                y += 9;
            };

            sectionHeader("1. PERSONAL DETAILS");
            drawRow("Full Name", get("Employee Name(AsperAadhar)"), "Date of Birth", get("Date of Birth"));
            drawRow("Gender", get("Gender"), "Blood Group", get("Blood Group"));
            drawRow("Marital Status", get("Marital Status"), "Contact No", get("Contact No"));
            drawRow("Aadhar No", get("AdharNo"), "Permanent Address", get("Permanent Address").substring(0, 30) + "...");
            
            y += 5;
            sectionHeader("2. BANKING & STATUTORY");
            drawRow("Bank Name", get("Bank Name"), "IFSC Code", get("IFSC Code"));
            drawRow("Account No", get("Account No"), "UAN Number", get("UAN Number"));

            y += 5;
            sectionHeader("3. FAMILY & EXPERIENCE");
            drawRow("Father's Name", get("Father name"), "Mother's Name", get("Mother Name"));
            drawRow("Wife's Name", get("Wife Name"), "Marriage Date", get("Date of Marriage"));
            
            const numChildren = parseInt(data.get("No.Childrens")) || 0;
            if (numChildren > 0) {
                for (let i = 1; i <= Math.min(numChildren, 3); i++) {
                    drawRow(`Child ${i} Name`, get(`Child ${i} Name`), `DOB`, get(`Child ${i} DOB`));
                }
            }
            
            drawRow("Education", get("Education"), "Experience", get("Scaffolding Work Experience") + " Years");
            drawRow("Emergency Contact", get("Emergency Contact No"), "Relation", get("Employee Relationwith EmergencyContactNo"));

            // Declaration
            y += 10;
            doc.setFontSize(8);
            doc.setFont("helvetica", "italic");
            doc.text("I hereby declare that the information provided above is true to the best of my knowledge.", 20, y);

            // Signatures
            y = 265;
            doc.line(20, y, 70, y);
            doc.line(140, y, 190, y);
            y += 5;
            doc.setFont("helvetica", "bold");
            doc.text("Employee Signature", 45, y, { align: "center" });
            doc.text("Authorized Signatory", 165, y, { align: "center" });

            doc.save(`SGB_JoiningForm_${data.get('Employee Name(AsperAadhar)') || 'Employee'}.pdf`);
        }
    </script>
</body>
</html>
