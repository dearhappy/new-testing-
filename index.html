<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGB Brandsafway - Professional Onboarding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .step { display: none; }
        .step.active { display: block; animation: fadeInRight 0.5s ease-out; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .input-focus:focus { ring: 2px; ring-color: #3b82f6; border-color: #3b82f6; outline: none; transition: all 0.3s ease; }
        .step-circle { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .step-circle.active { background-color: #2563eb; color: white; box-shadow: 0 0 15px rgba(37, 99, 235, 0.4); transform: scale(1.1); }
        @keyframes fadeInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">

    <div class="glass-card w-full max-w-3xl rounded-2xl shadow-2xl p-6 md:p-10 animate__animated animate__fadeIn">
        
        <!-- Header & Stepper -->
        <div class="mb-10">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">Joining Form</h1>
                    <p class="text-slate-500 text-sm mt-1">SGB Brandsafway Pvt Ltd</p>
                </div>
                <div class="hidden sm:flex space-x-4">
                    <div id="circle1" class="step-circle active font-bold">1</div>
                    <div id="circle2" class="step-circle bg-slate-100 text-slate-400 font-bold">2</div>
                    <div id="circle3" class="step-circle bg-slate-100 text-slate-400 font-bold">3</div>
                </div>
            </div>
            <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-blue-600 w-1/3 transition-all duration-500 ease-out"></div>
            </div>
        </div>

        <form id="onboardingForm" class="space-y-6">
            <!-- Hidden Fields (Blank) -->
            <input type="hidden" name="Date of Joining" value="">
            <input type="hidden" name="Designation" value="">
            <input type="hidden" name="Grade" value="">
            <input type="hidden" name="Project Code" value="">
            <input type="hidden" name="Gross Salary" value="">
            <input type="hidden" name="Current Address" value="">
            <input type="hidden" name="Work Location" value="">
            <input type="hidden" name="Client Name" value="">
            <input type="hidden" name="PF Location" value="">
            <input type="hidden" name="UAN remarks" value="">
            <input type="hidden" name="ESI Remark" value="">

            <!-- STEP 1 -->
            <div id="step1" class="step active">
                <h3 class="text-xl font-bold mb-6 text-slate-700">01. Personal & Bank Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Employee Name (Aadhar)</label><input type="text" name="Employee Name(AsperAadhar)" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Date of Birth</label><input type="date" name="Date of Birth" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Gender</label><select name="Gender" class="input-focus w-full px-4 py-2 border rounded-xl"><option value="">Select</option><option value="Male">Male</option><option value="Female">Female</option></select></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Contact No</label><input type="tel" name="Contact No" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Aadhar No</label><input type="text" name="AdharNo" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Bank Name</label><input type="text" name="Bank Name" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Account No</label><input type="text" name="Account No" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">IFSC Code</label><input type="text" name="IFSC Code" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                </div>
                <div class="mt-8 flex justify-end"><button type="button" onclick="nextStep(2)" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold">Next Part</button></div>
            </div>

            <!-- STEP 2 -->
            <div id="step2" class="step">
                <h3 class="text-xl font-bold mb-6 text-slate-700">02. Family & Experience</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Father's Name</label><input type="text" name="Father name" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">No. of Children</label><input type="number" name="No.Childrens" id="numChildren" min="0" max="3" oninput="updateChildrenFields()" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div id="childrenContainer" class="col-span-full space-y-4"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Experience (Years)</label><input type="number" name="Scaffolding Work Experience" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Emergency Contact</label><input type="tel" name="Emergency Contact No" class="input-focus w-full px-4 py-2 border rounded-xl"></div>
                </div>
                <div class="mt-8 flex justify-between"><button type="button" onclick="nextStep(1)" class="text-slate-500">Back</button><button type="button" onclick="nextStep(3)" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold">Next: Upload Docs</button></div>
            </div>

            <!-- STEP 3 -->
            <div id="step3" class="step">
                <h3 class="text-xl font-bold mb-6 text-slate-700">03. Documents Upload</h3>
                <p class="text-sm text-slate-500 mb-4">Upload clear photos or scans of your documents.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Aadhar Front</label><input type="file" id="file_aadhar_front" class="p-2 border w-full rounded-lg"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Aadhar Back</label><input type="file" id="file_aadhar_back" class="p-2 border w-full rounded-lg"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Bank Passbook</label><input type="file" id="file_bank" class="p-2 border w-full rounded-lg"></div>
                    <div><label class="text-xs font-bold text-slate-500 uppercase">Passport Size Photo</label><input type="file" id="file_photo" class="p-2 border w-full rounded-lg"></div>
                </div>
                <div class="mt-10 flex justify-between items-center">
                    <button type="button" onclick="nextStep(2)" class="text-slate-500">Back</button>
                    <button type="submit" id="submitBtn" class="bg-emerald-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg flex items-center">
                        <span id="btnText">Submit & Finish</span>
                        <div id="loader" class="hidden ml-3 w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwn1oDVHfFgKqMJfkguVyGxuY7WO5z9yupblXVc4J2zfiMZF6AJITZOWAZDJ3To-j0gBQ/exec';
        const form = document.getElementById('onboardingForm');

        function nextStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
            const bar = document.getElementById('progressBar');
            const circles = [1, 2, 3];
            bar.style.width = (step / 3 * 100) + '%';
            circles.forEach(c => {
                const el = document.getElementById('circle' + c);
                if (c <= step) el.classList.add('active');
                else el.classList.remove('active');
            });
        }

        async function getFileData(inputId) {
            const file = document.getElementById(inputId).files[0];
            if (!file) return null;
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = () => resolve({
                    base64: reader.result.split(',')[1],
                    mimeType: file.type,
                    fileName: file.name
                });
                reader.readAsDataURL(file);
            });
        }

        form.addEventListener('submit', async e => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const loader = document.getElementById('loader');

            submitBtn.disabled = true;
            btnText.innerText = "Uploading...";
            loader.classList.remove('hidden');

            const payload = new FormData(form);
            const data = {};
            payload.forEach((value, key) => data[key] = value);

            // Append files to data object as Base64
            data.file_aadhar_front = await getFileData('file_aadhar_front');
            data.file_aadhar_back = await getFileData('file_aadhar_back');
            data.file_bank = await getFileData('file_bank');
            data.file_photo = await getFileData('file_photo');

            fetch(scriptURL, { 
                method: 'POST', 
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'text/plain;charset=utf-8' }
            })
            .then(res => res.json())
            .then(res => {
                if(res.result === 'success') {
                    generatePDF();
                    alert('Submission Complete! Files saved and PDF generated.');
                    location.reload();
                } else { throw new Error(res.error); }
            })
            .catch(err => alert('Error: ' + err.message))
            .finally(() => {
                submitBtn.disabled = false;
                btnText.innerText = "Submit & Finish";
                loader.classList.add('hidden');
            });
        });

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const formData = new FormData(form);
            doc.setFontSize(20);
            doc.text("SGB BRANDSAFWAY JOINING FORM", 105, 20, {align: 'center'});
            doc.setFontSize(10);
            let y = 40;
            formData.forEach((val, key) => {
                if(val && y < 280) {
                    doc.text(`${key}: ${val}`, 20, y);
                    y += 8;
                }
            });
            doc.save(`JoiningForm_${formData.get('Employee Name(AsperAadhar)')}.pdf`);
        }

        function updateChildrenFields() {
            const container = document.getElementById('childrenContainer');
            const count = parseInt(document.getElementById('numChildren').value) || 0;
            container.innerHTML = '';
            for (let i = 1; i <= Math.min(count, 3); i++) {
                const div = document.createElement('div');
                div.className = 'p-3 bg-slate-50 border rounded-lg grid grid-cols-2 gap-2 text-xs';
                div.innerHTML = `<div><label>Child ${i} Name</label><input type="text" name="Child ${i} Name" class="w-full p-1 border"></div>
                                 <div><label>DOB</label><input type="date" name="Child ${i} DOB" class="w-full p-1 border"></div>`;
                container.appendChild(div);
            }
        }
    </script>
</body>
</html>
